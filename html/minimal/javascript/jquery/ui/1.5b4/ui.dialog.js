(function(B){var A={dragStart:"start.draggable",drag:"drag.draggable",dragStop:"stop.draggable",maxHeight:"maxHeight.resizable",minHeight:"minHeight.resizable",maxWidth:"maxWidth.resizable",minWidth:"minWidth.resizable",resizeStart:"start.resizable",resize:"drag.resizable",resizeStop:"stop.resizable"};B.widget("ui.dialog",{init:function(){var K=this;var L=this.options;var E=B(this.element).addClass("ui-dialog-content");if(!E.parent().length){E.appendTo("body")}E.wrap(document.createElement("div")).wrap(document.createElement("div"));var H=E.parent().addClass("ui-dialog-container").css({position:"relative"});var J=this.uiDialog=H.parent().hide().addClass("ui-dialog").css({position:"absolute",width:L.width,height:L.height,overflow:"hidden"});var C=E.attr("className").split(" ");B.each(C,function(M,N){if(N!="ui-dialog-content"){J.addClass(N)}});if(B.fn.resizable){J.append('<div class="ui-resizable-n ui-resizable-handle"></div>').append('<div class="ui-resizable-s ui-resizable-handle"></div>').append('<div class="ui-resizable-e ui-resizable-handle"></div>').append('<div class="ui-resizable-w ui-resizable-handle"></div>').append('<div class="ui-resizable-ne ui-resizable-handle"></div>').append('<div class="ui-resizable-se ui-resizable-handle"></div>').append('<div class="ui-resizable-sw ui-resizable-handle"></div>').append('<div class="ui-resizable-nw ui-resizable-handle"></div>');J.resizable({maxWidth:L.maxWidth,maxHeight:L.maxHeight,minWidth:L.minWidth,minHeight:L.minHeight,start:L.resizeStart,resize:L.resize,stop:function(N,M){L.resizeStop&&L.resizeStop.apply(this,arguments);B.ui.dialog.overlay.resize()}});if(!L.resizable){J.resizable("disable")}}H.prepend('<div class="ui-dialog-titlebar"></div>');var D=B(".ui-dialog-titlebar",H);this.uiDialogTitlebar=D;var I=(L.title)?L.title:(E.attr("title"))?E.attr("title"):"";D.append('<span class="ui-dialog-title">'+I+"</span>");D.append('<a href="#" class="ui-dialog-titlebar-close"><span>X</span></a>');this.uiDialogTitlebarClose=B(".ui-dialog-titlebar-close",D).hover(function(){B(this).addClass("ui-dialog-titlebar-close-hover")},function(){B(this).removeClass("ui-dialog-titlebar-close-hover")}).mousedown(function(M){M.stopPropagation()}).click(function(){K.close();return false});J.attr("tabindex",-1).css("outline",0).keydown(function(M){if(L.closeOnEscape){var N=27;M.keyCode&&M.keyCode==N&&K.close()}});var G=false;B.each(L.buttons,function(){return !(G=true)});if(G){var F=B('<div class="ui-dialog-buttonpane"/>').appendTo(J);B.each(L.buttons,function(M,N){B(document.createElement("button")).text(M).click(function(){N.apply(K.element,arguments)}).appendTo(F)})}if(B.fn.draggable){J.draggable({handle:".ui-dialog-titlebar",start:function(N,M){K.activate();L.dragStart&&L.dragStart.apply(this,arguments)},drag:L.drag,stop:function(N,M){L.dragStop&&L.dragStop.apply(this,arguments);B.ui.dialog.overlay.resize()}});if(!L.draggable){J.draggable("disable")}}J.mousedown(function(){K.activate()});D.click(function(){K.activate()});L.bgiframe&&B.fn.bgiframe&&J.bgiframe();if(L.autoOpen){this.open()}},setData:function(D,C,E){A[C]&&this.uiDialog.data(A[C],E);switch(C){case"draggable":this.uiDialog.draggable(E?"enable":"disable");break;case"height":this.uiDialog.height(E);break;case"position":this.position(E);break;case"resizable":this.uiDialog.resizable(E?"enable":"disable");break;case"title":B(".ui-dialog-title",this.uiDialogTitlebar).text(E);break;case"width":this.uiDialog.width(E);break}this.options[C]=E},position:function(G){var C=B(window),E=B(document),F=top=E.scrollTop(),D=E.scrollLeft();if(B.inArray(G,["center","top","right","bottom","left"])>=0){G=[G=="right"||G=="left"?G:"center",G=="top"||G=="bottom"?G:"middle"]}if(G.constructor!=Array){G==["center","middle"]}if(G[0].constructor==Number){D+=G[0]}else{switch(G[0]){case"left":D+=0;break;case"right":D+=(C.width())-(this.uiDialog.width());break;case"center":default:D+=(C.width()/2)-(this.uiDialog.width()/2)}}if(G[1].constructor==Number){top+=G[1]}else{switch(G[1]){case"top":top+=0;break;case"bottom":top+=(C.height())-(this.uiDialog.height());break;case"middle":default:top+=(C.height()/2)-(this.uiDialog.height()/2)}}top=top<F?F:top;this.uiDialog.css({top:top,left:D})},open:function(){this.overlay=this.options.modal?new B.ui.dialog.overlay(self):null;this.uiDialog.appendTo("body");this.position(this.options.position);this.uiDialog.show();this.moveToTop();this.activate();var C=null;var D={options:this.options};this.uiDialogTitlebarClose.focus();B(this.element).triggerHandler("dialogopen",[C,D],this.options.open)},activate:function(){!this.options.modal&&this.moveToTop()},moveToTop:function(){var D=this.options.zIndex,C=this.options;B(".ui-dialog:visible").each(function(){D=Math.max(D,parseInt(B(this).css("z-index"),10)||C.zIndex)});this.overlay&&this.overlay.$el.css("z-index",++D);this.uiDialog.css("z-index",++D)},close:function(){this.overlay&&this.overlay.destroy();this.uiDialog.hide();var D=null;var C={options:this.options};B(this.element).triggerHandler("dialogclose",[D,C],this.options.close);B.ui.dialog.overlay.resize()},destroy:function(){this.overlay&&this.overlay.destroy();this.uiDialog.hide();B(this.element).unbind(".dialog").removeClass("ui-dialog-content").hide().appendTo("body");this.uiDialog.remove();B.removeData(this.element,"dialog")}});B.extend(B.ui.dialog,{defaults:{autoOpen:true,bgiframe:false,buttons:{},closeOnEscape:true,draggable:true,height:200,minHeight:100,minWidth:150,modal:false,overlay:{},position:"center",resizable:true,width:300,zIndex:1000},overlay:function(C){this.$el=B.ui.dialog.overlay.create(C)}});B.extend(B.ui.dialog.overlay,{instances:[],events:B.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(C){return C+".dialog-overlay"}).join(" "),create:function(D){if(this.instances.length===0){B("a, :input").bind(this.events,function(){var F=false;var H=B(this).parents(".ui-dialog");if(H.length){var E=B(".ui-dialog-overlay");if(E.length){var G=parseInt(E.css("z-index"),10);E.each(function(){G=Math.max(G,parseInt(B(this).css("z-index"),10))});F=parseInt(H.css("z-index"),10)>G}else{F=true}}return F});B(document).bind("keydown.dialog-overlay",function(E){var F=27;E.keyCode&&E.keyCode==F&&D.close()});B(window).bind("resize.dialog-overlay",B.ui.dialog.overlay.resize)}var C=B("<div/>").appendTo(document.body).addClass("ui-dialog-overlay").css(B.extend({borderWidth:0,margin:0,padding:0,position:"absolute",top:0,left:0,width:this.width(),height:this.height()},D.options.overlay));D.options.bgiframe&&B.fn.bgiframe&&C.bgiframe();this.instances.push(C);return C},destroy:function(C){this.instances.splice(B.inArray(this.instances,C),1);if(this.instances.length===0){B("a, :input").add([document,window]).unbind(".dialog-overlay")}C.remove()},height:function(){if(B.browser.msie&&B.browser.version<7){var D=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);var C=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(D<C){return B(window).height()+"px"}else{return D+"px"}}else{return B(document).height()+"px"}},width:function(){if(B.browser.msie&&B.browser.version<7){var C=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);var D=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(C<D){return B(window).width()+"px"}else{return C+"px"}}else{return B(document).width()+"px"}},resize:function(){var C=B([]);B.each(B.ui.dialog.overlay.instances,function(){C=C.add(this)});C.css({width:0,height:0}).css({width:B.ui.dialog.overlay.width(),height:B.ui.dialog.overlay.height()})}});B.extend(B.ui.dialog.overlay.prototype,{destroy:function(){B.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);