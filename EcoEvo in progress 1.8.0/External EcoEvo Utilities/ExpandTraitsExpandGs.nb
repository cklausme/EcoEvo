(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     49841,       1112]
NotebookOptionsPosition[     46881,       1041]
NotebookOutlinePosition[     48288,       1086]
CellTagsIndexPosition[     48219,       1081]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"Package", "[", "\"\<EcoEvo`\>\"", "]"}], "\n", 
 RowBox[{"PackageExport", "[", "\"\<ExpandTraits\>\"", "]"}], "\n", 
 RowBox[{"PackageExport", "[", "\"\<ExpandGs\>\"", "]"}]}], "Code",
 CellChangeTimes->{{3.9110853460183*^9, 3.9110853467450953`*^9}, {
  3.9110866656006947`*^9, 3.9110866663934593`*^9}, {3.911087084583579*^9, 
  3.911087090413562*^9}, {3.9110881099830217`*^9, 3.911088137910088*^9}, {
  3.911252384287188*^9, 
  3.9112523899832907`*^9}},ExpressionUUID->"30a3abb7-5619-4151-bf83-\
b5bb8be60ec9"],

Cell[CellGroupData[{

Cell["ExpandTraits", "Subsection",
 CellChangeTimes->{{3.818203821810515*^9, 3.818203824233437*^9}},
 CellTags->"1.7.0",ExpressionUUID->"c3e62455-2b51-439f-90a9-2ee225e923af"],

Cell[CellGroupData[{

Cell["Usage", "Subsubsection",
 CellChangeTimes->{{3.8182039486193733`*^9, 
  3.818203949274516*^9}},ExpressionUUID->"61f4fb66-fbcd-4918-af95-\
cbf22cd8969f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExpandTraits", "::", "usage"}], "=", 
   "\"\<Expand traits across components.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.818203960632709*^9, 3.818203963242813*^9}, {
  3.832278693211083*^9, 3.8322786991945553`*^9}, {3.83227873111539*^9, 
  3.8322787441086807`*^9}, {3.832278803422418*^9, 3.832278817070903*^9}},
 CellLabel->
  "In[1485]:=",ExpressionUUID->"8806e63d-7d1e-4522-ac1e-82e046b93fd5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Definition", "Subsubsection",
 CellChangeTimes->{{3.818203952457459*^9, 
  3.818203953650962*^9}},ExpressionUUID->"e8e4f5aa-6923-4597-801e-\
f5110f6e5293"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"ExpandTraits", "[", "rulelist_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{"transitionbased", ",", "\n", "\t", 
      RowBox[{"rulelist", "/.", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SubscriptBox["trait", "i_"], "\[Rule]", "val_"}], ")"}], 
               "\[Rule]", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    SubscriptBox["trait", "i"], "->", "val"}], "}"}], ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    SubscriptBox[
                    RowBox[{"trait", "[", "gcomp", "]"}], "i"], "\[Rule]", 
                    "val"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                 "]"}]}]}], ",", "\n", "\t\t", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"trait", "\[Rule]", "val_"}], ")"}], "\[Rule]", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"trait", "->", "val"}], "}"}], ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"trait", "[", "gcomp", "]"}], "\[Rule]", "val"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                 "]"}]}]}]}], "}"}], "\n", "\t", ",", 
            RowBox[{"{", 
             RowBox[{"trait", ",", 
              RowBox[{"gtraits", "[", "gu", "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}], "]"}]}], ",", "\n", 
      "\t", "rulelist"}], "]"}]}], ";"}], "*)"}]], "Code",
 CellChangeTimes->{{3.818203827673374*^9, 3.818203934275371*^9}, {
   3.818204140869808*^9, 3.818204144076953*^9}, {3.8182045921452*^9, 
   3.818204669463491*^9}, {3.832278885435462*^9, 3.832278908706765*^9}, {
   3.832278951522914*^9, 3.832278984372849*^9}, 3.832281965590358*^9, {
   3.836407428252098*^9, 3.836407433536542*^9}, {3.836407470689526*^9, 
   3.83640749664123*^9}, {3.8364075345063457`*^9, 3.836407536289485*^9}, {
   3.8364075699551077`*^9, 3.836407572809204*^9}, {3.836410324198222*^9, 
   3.8364103605579357`*^9}, {3.8365673515810537`*^9, 3.836567352013136*^9}, {
   3.8415593000207567`*^9, 3.8415593405396137`*^9}, {3.84156107167866*^9, 
   3.8415611004620247`*^9}, {3.851897083270493*^9, 3.851897086144968*^9}, {
   3.851897128286192*^9, 3.851897129329359*^9}, 
   3.851992947095624*^9},ExpressionUUID->"f55c0d94-e396-4ad6-8178-\
2b99cc49ee93"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"ExpandTraits", "[", "rulelist_", "]"}], ":=", 
   RowBox[{"rulelist", "/.", 
    RowBox[{"DeleteNulls", "@", 
     RowBox[{"Flatten", "@", 
      RowBox[{"Table", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ngcomps", "[", "gu", "]"}], ">", "1"}], ",", "\n", "\t\t", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   SubscriptBox["trait", "i_"], "\[Rule]", "val_"}], ")"}], 
                 "\[Rule]", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    SubscriptBox["trait", "i"], "->", "val"}], "}"}], ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    SubscriptBox[
                    RowBox[{"trait", "[", "gcomp", "]"}], "i"], "\[Rule]", 
                    "val"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                   "]"}]}]}], ",", "\n", "\t\t\t", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"trait", "\[Rule]", "val_"}], ")"}], "\[Rule]", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"trait", "->", "val"}], "}"}], ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"trait", "[", "gcomp", "]"}], "\[Rule]", "val"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                   "]"}]}]}]}], "}"}], "*)"}], "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SubscriptBox["trait", "i_"], "\[Rule]", "val_"}], ")"}], 
               "\[Rule]", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   SubscriptBox[
                    RowBox[{"trait", "[", "gcomp", "]"}], "i"], "\[Rule]", 
                   "val"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}]}], 
              ",", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"trait", "\[Rule]", "val_"}], ")"}], "\[Rule]", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"trait", "[", "gcomp", "]"}], "\[Rule]", "val"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], 
                 "]"}]}]}]}], "}"}], "\n", "\t\t", ",", 
            RowBox[{"{", 
             RowBox[{"trait", ",", 
              RowBox[{"gtraits", "[", "gu", "]"}]}], "}"}]}], "]"}]}], "\n", 
         "\t", "]"}], "\n", ",", 
        RowBox[{"{", 
         RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}]}]}]}]}], 
  "*)"}]], "Code",
 CellChangeTimes->{{3.818203827673374*^9, 3.818203934275371*^9}, {
   3.818204140869808*^9, 3.818204144076953*^9}, {3.8182045921452*^9, 
   3.818204669463491*^9}, {3.832278885435462*^9, 3.832278908706765*^9}, {
   3.832278951522914*^9, 3.832278984372849*^9}, 3.832281965590358*^9, {
   3.836407428252098*^9, 3.836407433536542*^9}, {3.836407470689526*^9, 
   3.83640749664123*^9}, {3.8364075345063457`*^9, 3.836407536289485*^9}, {
   3.8364075699551077`*^9, 3.836407572809204*^9}, {3.836410324198222*^9, 
   3.8364103605579357`*^9}, {3.8365673515810537`*^9, 3.836567352013136*^9}, {
   3.8415593000207567`*^9, 3.8415593405396137`*^9}, {3.84156107167866*^9, 
   3.8415611004620247`*^9}, {3.851897083270493*^9, 3.851897086144968*^9}, {
   3.851897128286192*^9, 3.851897129329359*^9}, 3.851992947095624*^9, {
   3.8522211151038303`*^9, 3.852221140952675*^9}, {3.8522212285611763`*^9, 
   3.852221229794339*^9}, {3.852221270077497*^9, 3.852221313598362*^9}, {
   3.8522213749632473`*^9, 3.85222138647711*^9}, {3.8522214275664062`*^9, 
   3.852221449734743*^9}, {3.858983938827402*^9, 
   3.8589839765179033`*^9}},ExpressionUUID->"eaaa4c98-2c40-4655-8d09-\
40da82d71b5f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExpandTraits", "[", "rulelist_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"moments", "==", "True"}], ",", "\n", "\t\t", 
       RowBox[{"rulelist", "/.", 
        RowBox[{"DeleteNulls", "@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Table", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ngcomps", "[", "gu", "]"}], ">", "1"}], ",", "\n", 
              "\t\t\t\t", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", "\n", "\t\t\t\t", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    SubscriptBox["trait", "i_"], "\[Rule]", "val_"}], ")"}], 
                    "\[Rule]", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    SubscriptBox["trait", "i"], "->", "val"}], "}"}], ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    SubscriptBox[
                    RowBox[{"trait", "[", "gcomp", "]"}], "i"], "\[Rule]", 
                    "val"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                    "]"}]}]}], ",", "\n", "\t\t\t\t", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"trait", "\[Rule]", "val_"}], ")"}], "\[Rule]", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"trait", "->", "val"}], "}"}], ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"trait", "[", "gcomp", "]"}], "\[Rule]", "val"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                    "]"}]}]}]}], "}"}], "*)"}], "\n", "\t\t\t\t\t", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    SubscriptBox["trait", "i_"], "\[Rule]", "val_"}], ")"}], 
                   "\[Rule]", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    SubscriptBox[
                    RowBox[{"trait", "[", "gcomp", "]"}], "i"], "\[Rule]", 
                    "val"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}]}], 
                  ",", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"trait", "\[Rule]", "val_"}], ")"}], "\[Rule]", 
                   RowBox[{"Sequence", "@@", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"trait", "[", "gcomp", "]"}], "\[Rule]", "val"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], 
                    "]"}]}]}]}], "}"}], "\n", "\t\t\t\t", ",", 
                RowBox[{"{", 
                 RowBox[{"trait", ",", 
                  RowBox[{"gtraits", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
             "\n", "\t\t\t", "]"}], "\n", "\t\t", ",", 
            RowBox[{"{", 
             RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}]}]}]}], "\n", "\t", 
       ",", "\n", "\t\t", "rulelist"}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.818203827673374*^9, 3.818203934275371*^9}, {
   3.818204140869808*^9, 3.818204144076953*^9}, {3.8182045921452*^9, 
   3.818204669463491*^9}, {3.832278885435462*^9, 3.832278908706765*^9}, {
   3.832278951522914*^9, 3.832278984372849*^9}, 3.832281965590358*^9, {
   3.836407428252098*^9, 3.836407433536542*^9}, {3.836407470689526*^9, 
   3.83640749664123*^9}, {3.8364075345063457`*^9, 3.836407536289485*^9}, {
   3.8364075699551077`*^9, 3.836407572809204*^9}, {3.836410324198222*^9, 
   3.8364103605579357`*^9}, {3.8365673515810537`*^9, 3.836567352013136*^9}, {
   3.8415593000207567`*^9, 3.8415593405396137`*^9}, {3.84156107167866*^9, 
   3.8415611004620247`*^9}, {3.851897083270493*^9, 3.851897086144968*^9}, {
   3.851897128286192*^9, 3.851897129329359*^9}, 3.851992947095624*^9, {
   3.8522211151038303`*^9, 3.852221140952675*^9}, {3.8522212285611763`*^9, 
   3.852221229794339*^9}, {3.852221270077497*^9, 3.852221313598362*^9}, {
   3.8522213749632473`*^9, 3.85222138647711*^9}, {3.8522214275664062`*^9, 
   3.852221449734743*^9}, {3.858983938827402*^9, 3.8589839765179033`*^9}, {
   3.8591305114901447`*^9, 3.85913052313166*^9}, {3.8591306487086267`*^9, 
   3.859130710740349*^9}, {3.859418094558586*^9, 
   3.8594181198974257`*^9}},ExpressionUUID->"16b09b03-456b-48ac-ba1f-\
25e81bc5ddcc"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["ExpandGs", "Subsection",
 CellChangeTimes->{{3.818203821810515*^9, 3.818203824233437*^9}, {
  3.8322788252066603`*^9, 3.832278848256434*^9}, {3.832279018764592*^9, 
  3.832279023628057*^9}},
 CellTags->"1.7.0",ExpressionUUID->"dac5f202-f070-42be-8c73-34bda0ba4fab"],

Cell[CellGroupData[{

Cell["Usage", "Subsubsection",
 CellChangeTimes->{{3.8182039486193733`*^9, 
  3.818203949274516*^9}},ExpressionUUID->"7c754f91-4fcb-4222-a79b-\
a53d04bcd0b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExpandGs", "::", "usage"}], "=", 
   "\"\<Expand variance/covariances across species and components.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.818203960632709*^9, 3.818203963242813*^9}, {
  3.832278693211083*^9, 3.8322786991945553`*^9}, {3.83227873111539*^9, 
  3.8322787441086807`*^9}, {3.832278803422418*^9, 3.832278856384213*^9}, {
  3.859331531884413*^9, 3.8593315343719587`*^9}, {3.859331574977007*^9, 
  3.85933157838206*^9}},ExpressionUUID->"cf8b5be7-8a89-496a-8e53-\
470c6c2ee645"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Definition", "Subsubsection",
 CellChangeTimes->{{3.818203952457459*^9, 
  3.818203953650962*^9}},ExpressionUUID->"2d387b3b-b302-4b7b-b411-\
5477770e4a3f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"\[ScriptCapitalN]s", " ", "not", " ", "given"}], " ", "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ExpandGs", "[", "rulelist_", "]"}], ":=", 
    RowBox[{"rulelist", "/.", 
     RowBox[{"Flatten", "@", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\n", "\t", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ngcomps", "[", "gu", "]"}], ">", "1"}], ",", "\n", 
            "\t\t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               SubscriptBox["entry", "i_"], "\[Rule]", "val_"}], ")"}], 
             "\[Rule]", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 SubscriptBox[
                  RowBox[{"entry", "[", "gcomp", "]"}], "i"], "\[Rule]", 
                 "val"}], ",", 
                RowBox[{"{", 
                 RowBox[{"gcomp", ",", 
                  RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}]}], 
            ",", "\n", "\t\t", 
            RowBox[{"{", "}"}]}], "]"}], "\n", "\t", ",", 
          RowBox[{"{", 
           RowBox[{"entry", ",", 
            RowBox[{"Flatten", "@", 
             RowBox[{"MakeGMatrix", "[", "gu", "]"}]}]}], "}"}]}], "]"}], 
        "\n", ",", 
        RowBox[{"{", 
         RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}]}]}]}], ";"}]}]], "Code",\

 CellChangeTimes->{{3.818203827673374*^9, 3.818203934275371*^9}, {
   3.818204140869808*^9, 3.818204144076953*^9}, {3.8182045921452*^9, 
   3.818204669463491*^9}, {3.832278885435462*^9, 3.832278908706765*^9}, {
   3.832278951522914*^9, 3.832278994621258*^9}, {3.832279081279567*^9, 
   3.832279137569785*^9}, {3.8322793390576468`*^9, 3.832279347471703*^9}, {
   3.832279386626718*^9, 3.832279393539534*^9}, 3.832279434524822*^9, {
   3.832281766350472*^9, 3.8322818030871277`*^9}, {3.8322819120757504`*^9, 
   3.8322819152911243`*^9}, {3.83338764702353*^9, 3.833387652863051*^9}, {
   3.8333877862724*^9, 3.833387900553977*^9}, {3.8364080346577387`*^9, 
   3.8364080356011143`*^9}, {3.836408241706913*^9, 3.836408301938349*^9}, 
   3.836410320208494*^9, 3.852240544205022*^9, 3.8522405775819597`*^9, {
   3.852241035037795*^9, 3.8522410398225822`*^9}, {3.852241149726935*^9, 
   3.852241176239419*^9}, {3.8522412184680777`*^9, 3.8522412268306007`*^9}, 
   3.852241277534445*^9, {3.852241414115473*^9, 3.852241426070711*^9}, {
   3.852242020421419*^9, 3.852242145736237*^9}, {3.8522422359879627`*^9, 
   3.8522422647556763`*^9}, {3.852242302828079*^9, 3.8522423309556026`*^9}, {
   3.8522424071751738`*^9, 3.852242410293865*^9}, {3.8522425466845493`*^9, 
   3.852242719758276*^9}, {3.859244248927812*^9, 3.859244434443812*^9}, {
   3.859244971788122*^9, 3.8592450150088863`*^9}, {3.859480603239893*^9, 
   3.8594806117512293`*^9}, {3.859480661704486*^9, 3.859480730904064*^9}, {
   3.8594811583814707`*^9, 
   3.859481160697672*^9}},ExpressionUUID->"e3d4bede-8880-45a5-9151-\
dcffea7ca3a3"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"(*", " ", 
   RowBox[{"\[ScriptCapitalN]s", " ", "given"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{"ExpandGs", "[", 
    RowBox[{"in_", ",", "nsps_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"trsub", ",", "tmp"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"tmp", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"in", "/.", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"G", "[", "gu_", "]"}], "->", "vals_"}], ")"}], ":>", 
          RowBox[{"(", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"MakeGMatrix", "[", "gu", "]"}], "]"}], "->", 
             RowBox[{"Flatten", "[", "vals", "]"}]}], "]"}], ")"}]}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<tmp=\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], "\n", 
      RowBox[{"tmp", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"tmp", "/.", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            SubscriptBox[
             RowBox[{"G", "[", "gu_", "]"}], "sp_"], "->", "vals_"}], ")"}], ":>", 
          RowBox[{"(", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"MakeGMatrix", "[", 
               SubscriptBox["gu", "sp"], "]"}], "]"}], "->", 
             RowBox[{"Flatten", "[", "vals", "]"}]}], "]"}], ")"}]}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<tmp=\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", "\n", "\t", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ngcomps", "[", "gu", "]"}], ">", "1"}], ",", "\n", 
                 "\t\t", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    SubscriptBox["entry", "i_"], "\[Rule]", "val_"}], ")"}], 
                  "\[Rule]", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    SubscriptBox[
                    RowBox[{"entry", "[", "gcomp", "]"}], "i"], "\[Rule]", 
                    "val"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}]}], 
                 ",", "\n", "\t\t", 
                 RowBox[{"{", "}"}]}], "]"}], "\n", "\t", ",", 
               RowBox[{"{", 
                RowBox[{"entry", ",", 
                 RowBox[{"Flatten", "@", 
                  RowBox[{"MakeGMatrix", "[", "gu", "]"}]}]}], "}"}]}], "]"}],
              "\n", ",", 
             RowBox[{"{", 
              RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}]}]}]}], ";", "\n", 
        
        RowBox[{"Print", "[", 
         RowBox[{"\"\<tmp=\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], "\n", 
      RowBox[{"Flatten", "@", 
       RowBox[{"Table", "[", "\n", "\t", 
        RowBox[{
         RowBox[{"Table", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Table", "[", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"entry", ",", "\"\< \>\"", ",", 
                SubscriptBox["entry", "i"], ",", "\"\< \>\"", ",", 
                RowBox[{"Replace", "[", 
                 RowBox[{
                  SubscriptBox["entry", "i"], ",", "tmp"}], "]"}]}], "]"}], 
              ";"}], "*)"}], "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"Which", "[", "\n", "\t\t\t\t", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"Print", "[", "\"\<species-defined\>\"", "]"}], ";"}],
                "*)"}], "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{
                RowBox[{"Replace", "[", 
                 RowBox[{
                  SubscriptBox["entry", "i"], ",", "tmp"}], "]"}], "=!=", 
                SubscriptBox["entry", "i"]}], ",", "\n", "\t\t\t\t", 
               RowBox[{
                SubscriptBox["entry", "i"], "->", 
                RowBox[{"(", 
                 RowBox[{
                  SubscriptBox["entry", "i"], "/.", "tmp"}], ")"}]}], ",", 
               "\n", "\t\t\t\t", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", "\"\<guild-defined\>\"", "]"}], ";"}], 
                "*)"}], "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{"Replace", "[", 
                 RowBox[{"entry", ",", "tmp"}], "]"}], "=!=", "entry"}], ",", 
               "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{"trsub", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"gtrait", "->", 
                    SubscriptBox["gtrait", "i"]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"gtrait", ",", 
                    RowBox[{"gtraits", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                ";", "\n", "\t\t\t\t", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"Print", "[", 
                   RowBox[{"\"\<trsub=\>\"", ",", "trsub"}], "]"}], ";"}], 
                 "*)"}], "\n", "\t\t\t\t", 
                RowBox[{
                 SubscriptBox["entry", "i"], "->", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"entry", "/.", "tmp"}], "/.", "trsub"}], ")"}]}]}],
                ",", "\n", "\t\t\t\t", "Else", ",", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", "\"\<undefined\>\"", "]"}], ";"}], 
                "*)"}], 
               RowBox[{"{", "}"}]}], "\n", "\t\t\t", "]"}], "\n", "\t\t", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{
                RowBox[{"\[FormalCapitalN]", "[", "gu", "]"}], "/.", 
                "nsps"}]}], "}"}]}], "]"}], "\n", "\t", ",", 
           RowBox[{"{", 
            RowBox[{"entry", ",", 
             RowBox[{"Flatten", "@", 
              RowBox[{"MakeGMatrix", "[", "gu", "]"}]}]}], "}"}]}], "]"}], 
         "\n", ",", 
         RowBox[{"{", 
          RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}]}]}]}], "\n", "]"}]}], 
  "*)"}]], "Code",
 CellChangeTimes->{{3.818203827673374*^9, 3.818203934275371*^9}, {
   3.818204140869808*^9, 3.818204144076953*^9}, {3.8182045921452*^9, 
   3.818204669463491*^9}, {3.832278885435462*^9, 3.832278908706765*^9}, {
   3.832278951522914*^9, 3.832278994621258*^9}, {3.832279081279567*^9, 
   3.832279137569785*^9}, {3.8322793390576468`*^9, 3.832279347471703*^9}, {
   3.832279386626718*^9, 3.832279393539534*^9}, 3.832279434524822*^9, {
   3.832281766350472*^9, 3.8322818030871277`*^9}, {3.8322819120757504`*^9, 
   3.8322819152911243`*^9}, {3.83338764702353*^9, 3.833387652863051*^9}, {
   3.8333877862724*^9, 3.833387900553977*^9}, {3.8364080346577387`*^9, 
   3.8364080356011143`*^9}, {3.836408241706913*^9, 3.836408301938349*^9}, 
   3.836410320208494*^9, 3.852240544205022*^9, 3.8522405775819597`*^9, {
   3.852241035037795*^9, 3.8522410398225822`*^9}, {3.852241149726935*^9, 
   3.852241176239419*^9}, {3.8522412184680777`*^9, 3.8522412268306007`*^9}, 
   3.852241277534445*^9, {3.852241414115473*^9, 3.852241426070711*^9}, {
   3.852242020421419*^9, 3.852242145736237*^9}, {3.8522422359879627`*^9, 
   3.8522422647556763`*^9}, {3.852242302828079*^9, 3.8522423309556026`*^9}, {
   3.8522424071751738`*^9, 3.852242410293865*^9}, {3.8522425466845493`*^9, 
   3.852242719758276*^9}, {3.859244248927812*^9, 3.859244434443812*^9}, {
   3.859244971788122*^9, 3.8592450150088863`*^9}, {3.859331655207692*^9, 
   3.859331673512417*^9}, {3.859332020862092*^9, 3.8593320211597023`*^9}, {
   3.859332066941564*^9, 3.85933207156452*^9}, {3.859332174448793*^9, 
   3.859332178487863*^9}, {3.859332638830595*^9, 3.859332644114573*^9}, 
   3.8593328678660717`*^9, 3.859333113055488*^9, {3.859333159254023*^9, 
   3.8593332157856283`*^9}, {3.859333273246387*^9, 3.859333280377653*^9}, {
   3.859333319840844*^9, 3.8593333380579653`*^9}, {3.859333432904933*^9, 
   3.859333434701404*^9}, {3.8593334694954853`*^9, 3.8593335006086473`*^9}, 
   3.859333612104257*^9, {3.8593340478515673`*^9, 3.8593340571506453`*^9}, 
   3.859337255082838*^9, {3.859337509608378*^9, 3.8593375559054003`*^9}, {
   3.859337599791872*^9, 3.859337600851845*^9}, {3.8593377270017347`*^9, 
   3.859337801987747*^9}, {3.859337877756794*^9, 3.85933793400541*^9}, {
   3.859338009956379*^9, 3.859338052561117*^9}, {3.859338085670306*^9, 
   3.859338150125793*^9}, {3.859338196499915*^9, 3.8593383003064117`*^9}, {
   3.8593383545032787`*^9, 3.859338374418829*^9}, {3.859338429465925*^9, 
   3.859338461476487*^9}, {3.859338494140801*^9, 3.859338504375848*^9}, {
   3.85933856093637*^9, 3.859338646232809*^9}, {3.859338685303718*^9, 
   3.8593386860079927`*^9}, {3.859338722652412*^9, 3.859338737417491*^9}, {
   3.859338783648546*^9, 3.8593388146080227`*^9}, {3.8593388553102016`*^9, 
   3.859338877113133*^9}, {3.859338911512759*^9, 3.859338920502396*^9}, {
   3.859339023993207*^9, 3.859339059893983*^9}, {3.859339120419319*^9, 
   3.859339142700416*^9}, {3.8593392180135803`*^9, 3.859339247091895*^9}, {
   3.8593804282537203`*^9, 3.859380491503886*^9}, {3.8593806096694937`*^9, 
   3.8593806281831827`*^9}, {3.859382345904626*^9, 3.8593823782255774`*^9}, {
   3.859387246504957*^9, 3.859387283465465*^9}, {3.859387512589669*^9, 
   3.859387514483612*^9}, {3.859392875274165*^9, 3.859392892979785*^9}, {
   3.859393047966571*^9, 3.8593930770094852`*^9}, {3.859394455753447*^9, 
   3.859394468213916*^9}, {3.859394658154615*^9, 3.85939473684028*^9}, {
   3.859394796441853*^9, 3.859394880179467*^9}, {3.859395221218215*^9, 
   3.859395246761818*^9}, {3.859395878725337*^9, 3.8593958791679163`*^9}, {
   3.85941602696327*^9, 3.8594160869729548`*^9}, {3.859418297034925*^9, 
   3.8594183219166822`*^9}, {3.859480733897855*^9, 3.859480736585492*^9}, {
   3.859578491257477*^9, 3.859578508198888*^9}, {3.859581538163043*^9, 
   3.8595815500957317`*^9}, {3.8595815881939173`*^9, 3.859581602208167*^9}, {
   3.859581663499609*^9, 3.859581667655201*^9}, {3.859581744075715*^9, 
   3.859581757597438*^9}},ExpressionUUID->"144eebda-c8b2-4319-8ed8-\
c2b8ed896a39"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"\[ScriptCapitalN]s", " ", "given"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{"ExpandGs", "[", 
    RowBox[{"in_", ",", "nsps_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"trsub", ",", "tmp"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"tmp", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"in", "/.", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"G", "[", "gu_", "]"}], "->", "vals_"}], ")"}], ":>", 
          RowBox[{"(", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"MakeGMatrix", "[", "gu", "]"}], "]"}], "->", 
             RowBox[{"Flatten", "[", "vals", "]"}]}], "]"}], ")"}]}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<tmp=\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], "\n", 
      RowBox[{"tmp", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"tmp", "/.", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            SubscriptBox[
             RowBox[{"G", "[", "gu_", "]"}], "sp_"], "->", "vals_"}], ")"}], ":>", 
          RowBox[{"(", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"MakeGMatrix", "[", 
               SubscriptBox["gu", "sp"], "]"}], "]"}], "->", 
             RowBox[{"Flatten", "[", "vals", "]"}]}], "]"}], ")"}]}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<tmp=\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], "\n", 
      RowBox[{"If", "[", 
       RowBox[{"moments", ",", "\n", "\t", 
        RowBox[{"tmp", "=", 
         RowBox[{"tmp", "/.", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", "\n", "\t\t", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ngcomps", "[", "gu", "]"}], ">", "1"}], ",", 
                 RowBox[{"{", "\n", "\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    SubscriptBox["entry", "i_"], "\[Rule]", "val_"}], ")"}], 
                    "\[Rule]", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    SubscriptBox[
                    RowBox[{"entry", "[", "gcomp", "]"}], "i"], "\[Rule]", 
                    "val"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}]}]}], 
                   ",", "\n", "\t\t\t", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"entry", "\[Rule]", "val_"}], ")"}], "\[Rule]", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"entry", "[", "gcomp", "]"}], "\[Rule]", "val"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"gcomp", ",", 
                    RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], 
                    "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", 
                 RowBox[{"{", "}"}]}], "]"}], "\n", "\t\t", ",", 
               RowBox[{"{", 
                RowBox[{"entry", ",", 
                 RowBox[{"Flatten", "@", 
                  RowBox[{"MakeGMatrix", "[", "gu", "]"}]}]}], "}"}]}], "]"}],
              "\n", "\t", ",", 
             RowBox[{"{", 
              RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}]}]}]}]}], "\n", 
       "]"}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<tmp=\>\"", ",", "tmp"}], "]"}], ";"}], "*)"}], "\n", 
      RowBox[{"If", "[", 
       RowBox[{"moments", ",", "\n", "\t", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Table", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Table", "[", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"Table", "[", "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{"Table", "[", "\n", "\t\t\t\t\t", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"Print", "[", 
                   RowBox[{"entry", ",", "\"\< \>\"", ",", 
                    SubscriptBox["entry", "i"], ",", "\"\< \>\"", ",", 
                    RowBox[{"Replace", "[", 
                    RowBox[{
                    SubscriptBox["entry", "i"], ",", "tmp"}], "]"}]}], "]"}], 
                  ";"}], "*)"}], "\n", "\t\t\t\t\t", 
                RowBox[{
                 RowBox[{"Which", "[", "\n", "\t\t\t\t\t\t", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"Print", "[", "\"\<species-defined\>\"", "]"}], 
                    ";"}], "*)"}], "\n", "\t\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Replace", "[", 
                    RowBox[{
                    SubscriptBox["entry", "i"], ",", "tmp"}], "]"}], "=!=", 
                    SubscriptBox["entry", "i"]}], ",", "\n", "\t\t\t\t\t\t", 
                   RowBox[{
                    SubscriptBox["entry", "i"], "->", 
                    RowBox[{"(", 
                    RowBox[{
                    SubscriptBox["entry", "i"], "/.", "tmp"}], ")"}]}], ",", 
                   "\n", "\t\t\t\t\t\t", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Print", "[", "\"\<guild-defined\>\"", "]"}], 
                    ";"}], "*)"}], "\n", "\t\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{"Replace", "[", 
                    RowBox[{"entry", ",", "tmp"}], "]"}], "=!=", "entry"}], 
                   ",", "\n", "\t\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{"trsub", "=", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"gtrait", "->", 
                    SubscriptBox["gtrait", "i"]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"gtrait", ",", 
                    RowBox[{"gtraits", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                    ";", "\n", "\t\t\t\t\t\t", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<trsub=\>\"", ",", "trsub"}], "]"}], ";"}], 
                    "*)"}], "\n", "\t\t\t\t\t\t", 
                    RowBox[{
                    SubscriptBox["entry", "i"], "->", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"entry", "/.", "tmp"}], "/.", "trsub"}], 
                    ")"}]}]}], ",", "\n", "\t\t\t\t\t\t", "Else", ",", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Print", "[", "\"\<undefined\>\"", "]"}], ";"}], 
                    "*)"}], 
                   RowBox[{"{", "}"}]}], "\n", "\t\t\t\t\t", "]"}], "\n", 
                 "\t\t\t\t", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", 
                   RowBox[{
                    RowBox[{"\[FormalCapitalN]", "[", "gu", "]"}], "/.", 
                    "nsps"}]}], "}"}]}], "]"}], "\n", "\t\t\t", ",", 
               RowBox[{"{", 
                RowBox[{"entry", ",", 
                 RowBox[{"Flatten", "@", 
                  RowBox[{"MakeGMatrix", "[", "gcomp", "]"}]}]}], "}"}]}], 
              "]"}], "\n", "\t\t", ",", 
             RowBox[{"{", 
              RowBox[{"gcomp", ",", 
               RowBox[{"gcomps", "[", "gu", "]"}]}], "}"}]}], "]"}], "\n", 
           "\t", ",", 
           RowBox[{"{", 
            RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}]}], "\n", ",", "\n", 
        "\t", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Table", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Table", "[", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"Table", "[", "\n", "\t\t\t\t", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{"entry", ",", "\"\< \>\"", ",", 
                  SubscriptBox["entry", "i"], ",", "\"\< \>\"", ",", 
                  RowBox[{"Replace", "[", 
                   RowBox[{
                    SubscriptBox["entry", "i"], ",", "tmp"}], "]"}]}], "]"}], 
                ";"}], "*)"}], "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{"Which", "[", "\n", "\t\t\t\t\t", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"Print", "[", "\"\<species-defined\>\"", "]"}], 
                  ";"}], "*)"}], "\n", "\t\t\t\t\t", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Replace", "[", 
                   RowBox[{
                    SubscriptBox["entry", "i"], ",", "tmp"}], "]"}], "=!=", 
                  SubscriptBox["entry", "i"]}], ",", "\n", "\t\t\t\t\t", 
                 RowBox[{
                  SubscriptBox["entry", "i"], "->", 
                  RowBox[{"(", 
                   RowBox[{
                    SubscriptBox["entry", "i"], "/.", "tmp"}], ")"}]}], ",", 
                 "\n", "\t\t\t\t\t", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"Print", "[", "\"\<guild-defined\>\"", "]"}], 
                   ";"}], "*)"}], "\n", "\t\t\t\t\t", 
                 RowBox[{
                  RowBox[{"Replace", "[", 
                   RowBox[{"entry", ",", "tmp"}], "]"}], "=!=", "entry"}], 
                 ",", "\n", "\t\t\t\t\t", 
                 RowBox[{
                  RowBox[{"trsub", "=", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"gtrait", "->", 
                    SubscriptBox["gtrait", "i"]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"gtrait", ",", 
                    RowBox[{"gtraits", "[", "gu", "]"}]}], "}"}]}], "]"}]}], 
                  ";", "\n", "\t\t\t\t\t", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<trsub=\>\"", ",", "trsub"}], "]"}], ";"}], 
                   "*)"}], "\n", "\t\t\t\t\t", 
                  RowBox[{
                   SubscriptBox["entry", "i"], "->", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"entry", "/.", "tmp"}], "/.", "trsub"}], 
                    ")"}]}]}], ",", "\n", "\t\t\t\t\t", "Else", ",", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"Print", "[", "\"\<undefined\>\"", "]"}], ";"}], 
                  "*)"}], 
                 RowBox[{"{", "}"}]}], "\n", "\t\t\t\t", "]"}], "\n", 
               "\t\t\t", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{
                  RowBox[{"\[FormalCapitalN]", "[", "gu", "]"}], "/.", 
                  "nsps"}]}], "}"}]}], "]"}], "\n", "\t\t", ",", 
             RowBox[{"{", 
              RowBox[{"entry", ",", 
               RowBox[{"Flatten", "@", 
                RowBox[{"MakeGMatrix", "[", "gu", "]"}]}]}], "}"}]}], "]"}], 
           "\n", "\t", ",", 
           RowBox[{"{", 
            RowBox[{"gu", ",", "guilds"}], "}"}]}], "]"}]}]}], "\n", 
       "]"}]}]}], "\n", "]"}]}]}]], "Code",
 CellChangeTimes->{{3.818203827673374*^9, 3.818203934275371*^9}, {
   3.818204140869808*^9, 3.818204144076953*^9}, {3.8182045921452*^9, 
   3.818204669463491*^9}, {3.832278885435462*^9, 3.832278908706765*^9}, {
   3.832278951522914*^9, 3.832278994621258*^9}, {3.832279081279567*^9, 
   3.832279137569785*^9}, {3.8322793390576468`*^9, 3.832279347471703*^9}, {
   3.832279386626718*^9, 3.832279393539534*^9}, 3.832279434524822*^9, {
   3.832281766350472*^9, 3.8322818030871277`*^9}, {3.8322819120757504`*^9, 
   3.8322819152911243`*^9}, {3.83338764702353*^9, 3.833387652863051*^9}, {
   3.8333877862724*^9, 3.833387900553977*^9}, {3.8364080346577387`*^9, 
   3.8364080356011143`*^9}, {3.836408241706913*^9, 3.836408301938349*^9}, 
   3.836410320208494*^9, 3.852240544205022*^9, 3.8522405775819597`*^9, {
   3.852241035037795*^9, 3.8522410398225822`*^9}, {3.852241149726935*^9, 
   3.852241176239419*^9}, {3.8522412184680777`*^9, 3.8522412268306007`*^9}, 
   3.852241277534445*^9, {3.852241414115473*^9, 3.852241426070711*^9}, {
   3.852242020421419*^9, 3.852242145736237*^9}, {3.8522422359879627`*^9, 
   3.8522422647556763`*^9}, {3.852242302828079*^9, 3.8522423309556026`*^9}, {
   3.8522424071751738`*^9, 3.852242410293865*^9}, {3.8522425466845493`*^9, 
   3.852242719758276*^9}, {3.859244248927812*^9, 3.859244434443812*^9}, {
   3.859244971788122*^9, 3.8592450150088863`*^9}, {3.859331655207692*^9, 
   3.859331673512417*^9}, {3.859332020862092*^9, 3.8593320211597023`*^9}, {
   3.859332066941564*^9, 3.85933207156452*^9}, {3.859332174448793*^9, 
   3.859332178487863*^9}, {3.859332638830595*^9, 3.859332644114573*^9}, 
   3.8593328678660717`*^9, 3.859333113055488*^9, {3.859333159254023*^9, 
   3.8593332157856283`*^9}, {3.859333273246387*^9, 3.859333280377653*^9}, {
   3.859333319840844*^9, 3.8593333380579653`*^9}, {3.859333432904933*^9, 
   3.859333434701404*^9}, {3.8593334694954853`*^9, 3.8593335006086473`*^9}, 
   3.859333612104257*^9, {3.8593340478515673`*^9, 3.8593340571506453`*^9}, 
   3.859337255082838*^9, {3.859337509608378*^9, 3.8593375559054003`*^9}, {
   3.859337599791872*^9, 3.859337600851845*^9}, {3.8593377270017347`*^9, 
   3.859337801987747*^9}, {3.859337877756794*^9, 3.85933793400541*^9}, {
   3.859338009956379*^9, 3.859338052561117*^9}, {3.859338085670306*^9, 
   3.859338150125793*^9}, {3.859338196499915*^9, 3.8593383003064117`*^9}, {
   3.8593383545032787`*^9, 3.859338374418829*^9}, {3.859338429465925*^9, 
   3.859338461476487*^9}, {3.859338494140801*^9, 3.859338504375848*^9}, {
   3.85933856093637*^9, 3.859338646232809*^9}, {3.859338685303718*^9, 
   3.8593386860079927`*^9}, {3.859338722652412*^9, 3.859338737417491*^9}, {
   3.859338783648546*^9, 3.8593388146080227`*^9}, {3.8593388553102016`*^9, 
   3.859338877113133*^9}, {3.859338911512759*^9, 3.859338920502396*^9}, {
   3.859339023993207*^9, 3.859339059893983*^9}, {3.859339120419319*^9, 
   3.859339142700416*^9}, {3.8593392180135803`*^9, 3.859339247091895*^9}, {
   3.8593804282537203`*^9, 3.859380491503886*^9}, {3.8593806096694937`*^9, 
   3.8593806281831827`*^9}, {3.859382345904626*^9, 3.8593823782255774`*^9}, {
   3.859387246504957*^9, 3.859387283465465*^9}, {3.859387512589669*^9, 
   3.859387514483612*^9}, {3.859392875274165*^9, 3.859392892979785*^9}, {
   3.859393047966571*^9, 3.8593930770094852`*^9}, {3.859394455753447*^9, 
   3.859394468213916*^9}, {3.859394658154615*^9, 3.85939473684028*^9}, {
   3.859394796441853*^9, 3.859394880179467*^9}, {3.859395221218215*^9, 
   3.859395246761818*^9}, {3.859395878725337*^9, 3.8593958791679163`*^9}, {
   3.85941602696327*^9, 3.8594160869729548`*^9}, {3.859418297034925*^9, 
   3.8594183219166822`*^9}, {3.859480733897855*^9, 3.859480736585492*^9}, {
   3.859578491257477*^9, 3.859578508198888*^9}, {3.859581538163043*^9, 
   3.8595815500957317`*^9}, {3.8595815881939173`*^9, 3.859581602208167*^9}, {
   3.859581663499609*^9, 3.859581667655201*^9}, {3.859581744075715*^9, 
   3.859581811850337*^9}, 3.859582261511985*^9, {3.859582319097989*^9, 
   3.859582402937191*^9}, {3.859740429665365*^9, 3.859740433932274*^9}, {
   3.8597405036181583`*^9, 3.859740617174201*^9}, {3.859740649423232*^9, 
   3.8597406500210667`*^9}},ExpressionUUID->"16b90697-43cf-4977-ad8a-\
9ef999d80850"]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1405, 865},
WindowMargins->{{32, Automatic}, {Automatic, 0}},
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
PrintingOptions->{"PaperOrientation"->"Landscape",
"PaperSize"->{792, 612},
"PrintCellBrackets"->False,
"PrintMultipleHorizontalPages"->False,
"PrintRegistrationMarks"->False,
"PrintingMargins"->18},
ShowGroupOpener->True,
WholeCellGroupOpener->False,
TaggingRules->None,
ShowCellTags->True,
Magnification:>1.25 Inherited,
FrontEndVersion->"13.3 for Mac OS X ARM (64-bit) (July 24, 2023)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]], 
   Cell[
    RawData["Cell[StyleData[\"Input\"],\n InitializationCell->True]"], 
    InitializationCell -> True]}, Visible -> False, FrontEndVersion -> 
  "13.3 for Mac OS X ARM (64-bit) (July 24, 2023)", StyleDefinitions -> 
  "PrivateStylesheetFormatting.nb"],
ExpressionUUID->"cff1478d-9e4a-48ea-b9c7-7e2937191127"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "1.7.0"->{
  Cell[1119, 33, 175, 2, 85, "Subsection",ExpressionUUID->"c3e62455-2b51-439f-90a9-2ee225e923af",
   CellTags->"1.7.0"],
  Cell[15822, 374, 271, 4, 64, "Subsection",ExpressionUUID->"dac5f202-f070-42be-8c73-34bda0ba4fab",
   CellTags->"1.7.0"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"1.7.0", 47951, 1073}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 536, 9, 114, "Code",ExpressionUUID->"30a3abb7-5619-4151-bf83-b5bb8be60ec9"],
Cell[CellGroupData[{
Cell[1119, 33, 175, 2, 85, "Subsection",ExpressionUUID->"c3e62455-2b51-439f-90a9-2ee225e923af",
 CellTags->"1.7.0"],
Cell[CellGroupData[{
Cell[1319, 39, 158, 3, 56, "Subsubsection",ExpressionUUID->"61f4fb66-fbcd-4918-af95-cbf22cd8969f"],
Cell[1480, 44, 446, 9, 65, "Code",ExpressionUUID->"8806e63d-7d1e-4522-ac1e-82e046b93fd5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1963, 58, 161, 3, 56, "Subsubsection",ExpressionUUID->"e8e4f5aa-6923-4597-801e-f5110f6e5293"],
Cell[2127, 63, 3184, 71, 186, "Code",ExpressionUUID->"f55c0d94-e396-4ad6-8178-2b99cc49ee93"],
Cell[5314, 136, 4895, 110, 282, "Code",ExpressionUUID->"eaaa4c98-2c40-4655-8d09-40da82d71b5f"],
Cell[10212, 248, 5561, 120, 460, "Code",ExpressionUUID->"16b09b03-456b-48ac-ba1f-25e81bc5ddcc"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[15822, 374, 271, 4, 64, "Subsection",ExpressionUUID->"dac5f202-f070-42be-8c73-34bda0ba4fab",
 CellTags->"1.7.0"],
Cell[CellGroupData[{
Cell[16118, 382, 158, 3, 56, "Subsubsection",ExpressionUUID->"7c754f91-4fcb-4222-a79b-a53d04bcd0b9"],
Cell[16279, 387, 543, 11, 65, "Code",ExpressionUUID->"cf8b5be7-8a89-496a-8e53-470c6c2ee645"]
}, Open  ]],
Cell[CellGroupData[{
Cell[16859, 403, 161, 3, 56, "Subsubsection",ExpressionUUID->"2d387b3b-b302-4b7b-b411-5477770e4a3f"],
Cell[17023, 408, 3095, 66, 229, "Code",ExpressionUUID->"e3d4bede-8880-45a5-9151-dcffea7ca3a3"],
Cell[20121, 476, 10752, 225, 831, "Code",ExpressionUUID->"144eebda-c8b2-4319-8ed8-c2b8ed896a39"],
Cell[30876, 703, 15977, 334, 1510, "Code",ExpressionUUID->"16b90697-43cf-4977-ad8a-9ef999d80850"]
}, Open  ]]
}, Open  ]]
}
]
*)

